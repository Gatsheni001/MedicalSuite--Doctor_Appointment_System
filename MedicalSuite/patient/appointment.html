<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Appointments</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class a="navbar-brand" href="#">medicalSuite</a>
  <ul class="navbar-nav ml-auto">
    <li class="nav-item">
      <a class="nav-link" href="/patient/dashboard.html">Dashboard</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Appointment</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="logout-link" href="#">Logout</a>
    </li>
  </ul>
</nav>

<div class="container">
  <h1>Your Appointments</h1>
  <table class="table">
    <thead>
      <tr>
        <th>Appointment Date</th>
        <th>Appointment Time</th>
        <th>Doctor</th>
      </tr>
    </thead>
    <tbody id="appointmentsTable">
      <!-- Appointments will be dynamically added here -->
    </tbody>
  </table>
</div>

<!-- Add Firebase JavaScript SDK -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>

<script>
  var firebaseConfig = {
    apiKey: "AIzaSyBVmFA1iK5MSKLIhf3ACo6E0meUeRbPCgs",
    authDomain: "medicalsuite-99e48.firebaseapp.com",
    projectId: "medicalsuite-99e48",
    storageBucket: "medicalsuite-99e48.appspot.com",
    messagingSenderId: "679686285511",
    appId: "1:679686285511:web:be7e727760a15a61a9f6e2"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  var db = firebase.firestore();

  // Get the currently authenticated user (patient)
  var user = firebase.auth().currentUser;

  if (user) {
    // Use the authenticated user's UID as the patient's ID
    var patientId = user.uid;

    // Reference to the patient's appointments collection
    var appointmentsRef = db.collection("patients").doc(patientId).collection("appointments");

    // Fetch and display patient's appointments
    appointmentsRef.get().then((querySnapshot) => {
      var appointmentsTable = document.getElementById("appointmentsTable");

      querySnapshot.forEach((doc) => {
        var data = doc.data();

        var appointmentDate = data.appointmentDate;
        var appointmentTime = data.appointmentTime;
        var doctorId = data.doctorId;

        // Use the unique UID within the appointments as the appointment ID
        var appointmentId = doc.id;

        // Fetch doctor information
        db.collection("doctors").doc(doctorId).get().then((doctorDoc) => {
          if (doctorDoc.exists) {
            var doctorName = doctorDoc.data().doctorName;
            var doctorSurname = doctorDoc.data().doctorSurname;
            var doctorFullName = doctorName + " " + doctorSurname;

            // Create a new row in the table for each appointment
            var row = appointmentsTable.insertRow();
            var cellDate = row.insertCell(0);
            var cellTime = row.insertCell(1);
            var cellDoctor = row.insertCell(2);

            cellDate.innerHTML = appointmentDate;
            cellTime.innerHTML = appointmentTime;
            cellDoctor.innerHTML = doctorFullName;
          }
        });
      });
    });
  } else {
    // Handle the case where the user is not authenticated
    console.error("User is not authenticated.");
  }
</script>

<!-- Bootstrap JavaScript -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!--This code is for the logout -->
<script>
    document.getElementById("logout-link").addEventListener("click", function(event) {
      event.preventDefault(); // Prevent the default link behavior
  
      // Send a request to your server to log the user out (if needed)
      // Make sure this part is functioning correctly
  
      // Redirect the user to the login page or homepage after logout
      window.location.href = "/index.html"; // Homepage
    });
  </script>
  
</body>
</html>
