<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Appointments</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">Medical Suite</a>
  <ul class="navbar-nav ml-auto">
    <li class="nav-item">
      <a class="nav-link" href="/patient/dashboard.html">Dashboard</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/patient/appointment.html">Appointment</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="logout-link" href="#">Logout</a>
    </li>
  </ul>
</nav>

<div class="container">
  <h1>Your Appointments</h1>

  <table class="table">
    <thead>
      <tr>
        <th>Appointment Date</th>
        <th>Appointment Time</th>
        <th>Doctor</th>
      </tr>
    </thead>
    <tbody id="appointmentsTable">
      <!-- Appointments will be dynamically added here -->
    </tbody>
    <div class="modal-body">
      <!-- Add Patient Form -->
  </table>
</div>

<!-- Include the Firebase JavaScript SDK -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>

<script>
  // Firebase configuration
  var firebaseConfig = {
        apiKey: "AIzaSyBVmFA1iK5MSKLIhf3ACo6E0meUeRbPCgs",
        authDomain: "medicalsuite-99e48.firebaseapp.com",
        projectId: "medicalsuite-99e48",
        storageBucket: "medicalsuite-99e48.appspot.com",
        messagingSenderId: "679686285511",
        appId: "1:679686285511:web:be7e727760a15a61a9f6e2"
    };
   // Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Function to display appointments
function displayAppointments() {
  var user = firebase.auth().currentUser;
  if (user) {
    var appointmentsRef = firebase.firestore().collection("patients").doc(user.uid).collection("appointments");

    appointmentsRef.get().then(function(querySnapshot) {
      var tableRows = "";
      querySnapshot.forEach(function(doc) {
        var appointment = doc.data();
        tableRows += "<tr>";
        tableRows += "<td>" + doc.id + "</td>";
        tableRows += "<td>" + appointment.appointmentDate + "</td>";
        tableRows += "<td>" + appointment.appointmentTime + "</td>";
        // Add other appointment details here
        tableRows += "</tr>";
      });
      $("tbody").html(tableRows);
    });
  } else {
    // Handle the case where the user is not authenticated
    alert("User not authenticated. Please log in.");
    // You can redirect them to the login page or display an error message
  }
}

// Event listener for changes in authentication state
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in
    displayAppointments();
  } else {
    // No user is signed in
    // Handle the case where the user is not authenticated
    alert("User not authenticated. Please log in.");
    // You can redirect them to the login page or display an error message
  }
});
displayAppointments();
</script>

<!-- Include Bootstrap JavaScript dependencies (jQuery and Popper.js) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-..." crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Logout script -->
<script>
  document.getElementById("logout-link").addEventListener("click", function(event) {
    event.preventDefault(); // Prevent the default link behavior
  
    // Perform any necessary actions for logging the user out (server-side)
    // Redirect the user to the login page or homepage after logout
    window.location.href = "/index.html"; // Redirect to the homepage or login page
  });
</script>
</body>
</html>
